<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/turretcss/dist/turretcss.min.css"
      crossorigin="anonymous"
    />
    <title>Picture in Picture</title>
  </head>
  <body class="container">
    <h1>Picture In Picture Viewer for YouTube</h1>
    <main>
      <h2>Watch</h2>
      <iframe
        id="video-main"
        allow="accelerometer; autoplay; encrypted-media; gyroscope"
        allowfullscreen
        >No main video found. Set your v1 value below.</iframe
      >
      <iframe
        id="video-pip"
        allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"
        >No PIP video found. Set your v2 value below.</iframe
      >
    </main>
    <aside>
      <a
        href="https://www.pcmag.com/how-to/how-to-enable-picture-in-picture-video-in-your-browser"
        >Make sure PIP is enabled in your browser</a
      >
    </aside>
    <div>
      <h2>Create video link</h2>
      <form onsubmit="return createLinkHandler(event)">
        <p class="field input-group">
          <label for="video1-input">Video 1 (main)</label>
          <input id="video1-input" type="text" name="video1" required />
        </p>
        <p class="field input-group">
          <label for="video2-input">Video 2 (PIP)</label>
          <input id="video2-input" type="text" name="video2" required />
        </p>
        <button type="submit" class="button button-primary">Create link</button>
        <button type="reset" class="button button-secondary">Reset</button>
      </form>
      <label for="new-link">Result link</label>
      <input readonly id="new-link-text" />
      <a id="new-link" href="#">Go to page</a>
    </div>
    <noscript>
      <strong
        >We're sorry but communote doesn't work properly without JavaScript
        enabled. Please enable it to continue.</strong
      >
    </noscript>
    <script>
      window.onload = function () {
        let query = queryObject(window.location.search);
        const v1 = query.v1 || "";
        const v2 = query.v2 || "";
        if (v1 && v2) {
          const link1 = addTube(v1);
          const link2 = addTube(v2);
          document.getElementById("video1-input").value = link1;
          document.getElementById("video2-input").value = link2;
          document.getElementById("video-main").src = link1 + "?controls=0";
          document.getElementById("video-pip").src = link2;
        } else if (v1) {
          document.getElementById("video1-input").value = addTube(v1);
        } else if (v2) {
          document.getElementById("video2-input").value = addTube(v2);
        }
        createLink(v1, v2);
      };
      function queryObject(queryString) {
        let queryStrings = queryString.replace("?", "").split("&");
        let query = {};
        for (let i = 0, len = queryStrings.length; i < len; i++) {
          const parts = queryStrings[i].split("=");
          query[parts[0]] = parts[1];
        }
        return query;
      }
      function createLinkHandler(evt) {
        evt.preventDefault();
        const inputs = filterForms(evt.target);
        const v1 = stripTube(inputs.video1);
        const v2 = stripTube(inputs.video2);
        createLink(v1, v2);
      }
      function createLink(v1, v2) {
        const link =
          window.location.href.split("?")[0] + "?v1=" + v1 + "&v2=" + v2;
        document.getElementById("new-link").href = link;
        document.getElementById("new-link-text").value = link;
      }
      function filterForms(target) {
        const inputs = target.querySelectorAll("input");
        let filtered = {};

        inputs.forEach((entry) => {
          const name = entry.name;
          if (entry.multiple) {
            const options = entry.selectedOptions;
            const files = entry.files;
            const values = [];
            if (options) {
              for (let pair of options) {
                values.push(pair.value);
              }
            } else if (files) {
              for (let file of files) {
                values.push(file);
              }
            }
            if (values.length) {
              filtered[name] = values;
            }
          } else {
            const val = entry.value;
            if (typeof val === "string") {
              filtered[name] = val;
            }
          }
        });
        return filtered;
      }
      function stripTube(link) {
        const query = queryObject(link.split("?")[1]);
        return query.v;
      }
      function addTube(vId) {
        return "https://www.youtube.com/embed?v=" + vId;
      }
    </script>
  </body>
</html>
